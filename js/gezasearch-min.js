var hPP,inpBackup,term,bm25,returnVal,descriptionList,commentList,titleList,usernameList,nameList,bioList,identifierList,bNL=[],bCL=[],bBL=[],bUL=[],bTL=[],bDL=[],bIL=[],results=[],resultsID=[],data=[],avgScores=[],listAll="listAll",next="++",prev="--",three=1.8;function arrayJudger(e,t){return arrays=[],arrays.push(e),arrays.push(t),arrays.shift().filter(function(e){return arrays.every(function(t){return-1!==t.indexOf(e)})}).length/((e.length+t.length)/2)}function lDis(e,t){if(0===e.length)return t.length;if(0===t.length)return e.length;var r,i,s=[];for(r=0;r<=t.length;r++)s[r]=[r];for(i=0;i<=e.length;i++)s[0][i]=i;for(r=1;r<=t.length;r++)for(i=1;i<=e.length;i++)t.charAt(r-1)==e.charAt(i-1)?s[r][i]=s[r-1][i-1]:s[r][i]=Math.min(s[r-1][i-1]+1,Math.min(s[r][i-1]+1,s[r-1][i]+1));return resultToRet=s[t.length][e.length],resultToRet-=t.length+e.length+arrayJudger(e.split(""),t.split("")),resultToRet}function switchPage(pageNum){try{"++"==pageNum?(page++,returnVal=results.slice(-(results.length-page*hPP)),returnVal.length=hPP):"--"==pageNum?(page--,returnVal=results.slice(-(results.length-page*hPP)),returnVal.length=hPP):"listAll"==pageNum?(page=0,returnVal=results):(returnVal=results.slice(-(results.length-pageNum*hPP)),returnVal.length=hPP,page=pageNum),returnVal=returnVal.filter(function(e){return void 0!==e});var insert="totResults: "+results.length+", hitsPerPage: "+hPP+", term: '"+theTerm+"', ";for(resString="{"+insert+"page: "+page+", results: "+returnVal.length+", value: [",d=0;d<returnVal.length;d++)resString+="{"+returnVal[d]+"}, ";resString=resString.slice(0,-2)+"]}"}catch(e){resString="{totResults: "+results.length+", hitsPerPage: "+hPP+", term: '"+term+"', page: "+page+", results: 0, value: []}"}return eval("("+resString+")")}function search(e,t,r){term=e.toLowerCase(),hPP=r;var s=term.split(" "),n=t,l=0;bm25=[];var a,u="abcdefghijklmnopqrstuvwxyz0123456789ùûüÿàâæçéèêëïîôœșțţşáéíöóőüúűäöüāēīōūυιοβάϊΐύϋΰåäîûŵŷşďňřšťýςσρτυθιοπαδφγηξκλζχψωβνяшертыуиопющэасдфчгйкльжмнбвцхзþðμ ".split("");for(i=0;i<term.length;i++)-1==u.indexOf(term[i])&&u.push(term[i]);for(x=0;x<n.length;x++)for(n[x]=n[x].toLowerCase(),l=(l+n[x].length)/2,i=0;i<n[x].length;i++)-1==u.indexOf(n[x][i])&&((a=n[x].split(""))[i]=" ",n[x]=a.join(""));for(x=0;x<n.length;x++)for(i=0;i<n[x].length;i++)" "==n[x][i]&&" "==n[x][i+1]&&((a=n[x].split(""))[i]="",n[x]=a.join(""));for(x=0;x<n.length;x++){var h=0,o=0;for(docSpl=n[x].split(" "),m=0;m<s.length;m++){var g=s[m],c=0;for(f=0;f<docSpl.length;f++)0===lDis(docSpl[f],g)?o+=10*(term.length+1):1==lDis(docSpl[f],g)?o+=4*term.length:2==lDis(docSpl[f],g)?o+=3*term.length:docSpl.length>4&&3==lDis(docSpl[f],g)?o+=2.5*term.length:docSpl.length>5&&4==lDis(docSpl[f],g)?o+=1.6*term.length:o+=docSpl.length-lDis(docSpl[f],g)-1,o<0&&(o=0);for(b=0;b<n.length;b++)n[b].indexOf(g)>=0&&c++;c/=2,idf=Math.log((n.length-c+.5)/(c+.5)),h+=idf*(2.2*n[x].split(s[m]).length/(n[x].split(s[m]).length+1.2*(.25+n[x].length/l*.75)))}bm25.push(h+o/1.5)}return bm25}function bind(e,t,r,s){try{for(theTerm=e,inpBackup=t,titleList=[],descriptionList=[],commentList=[],usernameList=[],nameList=[],identifierList=[],bioList=[],num=0;num<t.length;num++)"project"==t[num].type?"1"==t[num].privacy&&(titleList.push(t[num].title),descriptionList.push(t[num].description),identifierList.push(t[num].identifier),commentList.push(t[num].comments),bTL.push(t[num].title),bDL.push(t[num].description),bIL.push(t[num].identifier),bCL.push(t[num].comments)):(bioList.push(t[num].bio),nameList.push(t[num].name),usernameList.push(t[num].username),bBL.push(t[num].bio),bNL.push(t[num].name),bUL.push(t[num].username));titles=titleList,comments=commentList,usernames=usernameList,names=nameList,bios=bioList,descriptions=descriptionList,identifiers=identifierList;var n=[],l=[],a=[],u=[];for(k=0;k<identifiers.length;k++)n.push(identifiers[k].split("-")[0]),l.push(identifiers[k].split("-")[1]),a.push(identifiers[k].split("-")[2]);for(identifer1=search(e,n,r),identifer2=search(e,l,r),identifer3=search(e,a,r),k=0;k<n.length;k++)u.push((identifer1[k]+identifer2[k]+identifer3[k])/3);titleScores=search(e,titles,r),descScores=search(e,descriptions,r);var h=[];for(k=0;k<comments.length;k++){h.push(search(e,comments[k],r));var o=0;for(forC=0;forC<h[k].length;forC++)o+=h[k][forC];h[k]=o/h[k].length,"NaN"==h[k].toString()&&(h[k]=0)}for(nameScores=search(e,names,r),uNameScores=search(e,usernames,r),bioScores=search(e,bios,r),i=0;i<descScores.length;i++)avgScores.push((.4*titleScores[i]+.3*descScores[i]+.25*h[i]+.3*u[i])/4),data.push("description: '"+bDL[i]+"', title: '"+bTL[i]+"', _id: '"+inpBackup[i]._id+"', identifier: '"+bIL[i]+"', type: 'project'");for(i=0;i<nameScores.length;i++)avgScores.push((.3*nameScores[i]+.25*uNameScores[i]+.2*bioScores[i])/3.3),data.push("username: '"+bUL[i]+"', name: '"+bNL[i]+"', bio: '"+bBL[i]+"', _id: '"+inpBackup[i]._id+"', type: 'user'");for(z=0;z<avgScores.length;z++){var g=0;for(q=0;q<avgScores.length;q++)if(avgScores[q]>g){g=avgScores[q];var c=q}avgScores[c]=avgScores[c]-1,resultsID.push(c),results.push(data[c])}var p=switchPage(s).value;if(void 0===p)throw"Primary page display error in switchPage function";var m=switchPage(s);return delete m.value,{success:!0,properties:m,results:p}}catch(e){return{success:!1,error:e}}}
